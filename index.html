<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulador de Pr√©stamo</title>
  <style>
    :root {
      --fs-h1: clamp(1.4rem, 5vw, 2rem);
      --fs-h2: clamp(1.1rem, 4vw, 1.4rem);
      --fs-label: clamp(0.95rem, 3.5vw, 1.1rem);
      --fs-input: clamp(1rem, 4vw, 1.15rem);
      --fs-result: clamp(1rem, 4vw, 1.15rem);
    }

    body { margin: 0; padding: 0; background: #f5f5f5; }

    .simulador-prestamo-container {
      font-family: Arial, sans-serif;
      max-width: 720px;
      width: 100%;
      margin: 16px auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    h1 {
      text-align: center;
      color: #007bff;
      border-bottom: 2px solid #007bff;
      padding-bottom: 10px;
      margin-bottom: 20px;
      font-size: var(--fs-h1);
    }

    h2 {
      color: #333;
      margin-top: 20px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 6px;
      font-size: var(--fs-h2);
    }

    .input-group, .result-line { margin-bottom: 14px; }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: bold;
      color: #555;
      font-size: var(--fs-label);
    }

    input[type="number"], input[readonly] {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: var(--fs-input);
      text-shadow: 0.5px 0.5px 1px rgba(0,0,0,0.12);
      background-color: #fff;
      color: #000;
      box-sizing: border-box;
    }

    input[readonly] {
      background-color: #f7f7f7;
      border: 1px dashed #999;
    }

    .result-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px dashed #eee;
      font-size: var(--fs-result);
      flex-wrap: wrap;
      gap: 6px 12px;
    }

    .result-line:last-of-type { border-bottom: none; }
    .result-line span { font-weight: 500; color: #333; }

    .result-line strong {
      color: #28a745;
      font-weight: bold;
      background-color: #e9f7eb;
      padding: 6px 10px;
      border-radius: 6px;
      text-shadow: 0.6px 0.6px 1.2px rgba(0,0,0,0.18);
    }

    .result-line.highlight strong {
      color: #007bff;
      background-color: #e6f2ff;
      font-size: calc(var(--fs-result) * 1.15);
    }

    @media (max-width: 600px) {
      .simulador-prestamo-container { padding: 14px; margin: 10px; }
      .result-line { flex-direction: column; align-items: flex-start; }
      .result-line strong { width: 100%; text-align: left; }
    }

    @media (prefers-color-scheme: dark) {
      body { background: #121212; }
      .simulador-prestamo-container {
        background: #1e1f22; color: #e8e8e8;
        box-shadow: 0 4px 16px rgba(0,0,0,0.5);
      }
      h1 { color: #66a3ff; border-color: #66a3ff; }
      h2 { color: #e0e0e0; border-color: #333; }
      label { color: #ccc; }
      input[type="number"] {
        background-color: #2a2b2f; border-color: #444; color: #fff;
      }
      input[readonly] {
        background-color: #2a2b2f; border-color: #666; color: #fff;
      }
      .result-line { border-color: #2c2c2c; }
      .result-line strong { background-color: #203a28; color: #7ddc8c; }
      .result-line.highlight strong { background-color: #20334a; color: #7fb8ff; }
    }
  </style>
</head>
<body>
  <div class="simulador-prestamo-container">
    <h1>SIMULADOR DE PR√âSTAMO üí∏</h1>

    <h2>Datos de Entrada (Editables)</h2>
    <div class="input-group">
      <label for="loanAmount">Monto Solicitud Pr√©stamo ($):</label>
      <input type="number" id="loanAmount" value="3000000" min="1" oninput="calculateLoan()" />
    </div>

    <div class="input-group">
      <label for="numPayments">N√∫mero de Cuotas (M√°x. 18):</label>
      <input type="number" id="numPayments" value="18" min="1" max="18" step="1" oninput="calculateLoan()" />
    </div>

    <div class="input-group">
      <label for="minimumSavings">Ahorro M√≠nimo Sugerido (Valor Extra por Cuota $):</label>
      <input type="number" id="minimumSavings" value="55000" min="55000" oninput="calculateLoan()" />
    </div>

    <h2>Tasa de Inter√©s Aplicada (Autom√°tico)</h2>
    <div class="input-group">
      <label for="interestRate">Tasa de Inter√©s Mensual (%):</label>
      <input type="text" id="interestRate" value="1.2%" readonly />
    </div>

    <h2>Resultados (Autom√°ticos y No Editables)</h2>
    <div class="result-line">
      <span>Intereses por Cuota:</span>
      <strong id="interestPerPayment"></strong>
    </div>
    <div class="result-line">
      <span>Valor Cuota (Principal):</span>
      <strong id="principalPerPayment"></strong>
    </div>
    <div class="result-line">
      <span>Valor Cuota + Intereses (Total a Pagar Mensual):</span>
      <strong id="totalPayment"></strong>
    </div>
    <div class="result-line highlight">
      <span>Proyecci√≥n Pago Total (Cuotas + Intereses):</span>
      <strong id="totalRepayment"></strong>
    </div>
    <div class="result-line highlight">
      <span>Estimaci√≥n Cuota Total + Ahorro M√≠nimo Sugerido:</span>
      <strong id="totalEstimate"></strong>
    </div>
  </div>

  <script>
    function getInterestRate(principal) {
      if (principal === 0) return 0;
      else if (principal < 500000) return 4.5;
      else if (principal < 1000000) return 4.0;
      else if (principal < 1500000) return 3.5;
      else if (principal < 2000000) return 3.0;
      else if (principal < 2500000) return 2.5;
      else if (principal < 3000000) return 2.0;
      else return 1.2;
    }

    function calculateLoan() {
      const principalEl = document.getElementById("loanAmount");
      const periodsEl  = document.getElementById("numPayments");
      const savingsEl  = document.getElementById("minimumSavings");

      const principal = parseFloat(principalEl.value) || 0;
      let periods     = parseInt(periodsEl.value) || 1;
      let savings     = parseFloat(savingsEl.value);

      const MIN_SAVINGS = 55000;
      if (isNaN(savings) || savings < MIN_SAVINGS) {
        savings = MIN_SAVINGS;
        savingsEl.value = MIN_SAVINGS;
      }

      const MAX_PERIODS = 18;

      // Tasa
      const ratePercent = getInterestRate(principal);
      const monthlyRate = ratePercent / 100;
      document.getElementById("interestRate").value = ratePercent.toFixed(2) + "%";

      // Formateador COP
      const fmt = new Intl.NumberFormat("es-CO", { style: "currency", currency: "COP", minimumFractionDigits: 0 });

      // Si principal inv√°lido, limpiar resultados
      if (principal <= 0) {
        const zero = fmt.format(0);
        document.getElementById("interestPerPayment").textContent  = zero;
        document.getElementById("principalPerPayment").textContent = zero;
        document.getElementById("totalPayment").textContent        = zero;
        document.getElementById("totalRepayment").textContent      = zero;
        document.getElementById("totalEstimate").textContent       = zero;

        periods = Math.min(Math.max(periods, 1), MAX_PERIODS);
        periodsEl.value = periods;
        return;
      }

      // Validaci√≥n: cuota principal por pago >= ahorro sugerido
      let minPeriodsBySavings = Math.ceil(principal / savings);
      minPeriodsBySavings = Math.min(Math.max(minPeriodsBySavings, 1), MAX_PERIODS);
      periods = Math.max(periods, minPeriodsBySavings);
      periods = Math.min(periods, MAX_PERIODS);
      periodsEl.value = periods;

      // C√°lculos
      const interestPerPayment  = principal * monthlyRate;
      const principalPerPayment = principal / periods;
      const totalPayment        = principalPerPayment + interestPerPayment;
      const totalRepayment      = totalPayment * periods;
      const totalEstimate       = totalPayment + savings;

      // Actualizar resultados
      document.getElementById("interestPerPayment").textContent  = fmt.format(interestPerPayment);
      document.getElementById("principalPerPayment").textContent = fmt.format(principalPerPayment);
      document.getElementById("totalPayment").textContent        = fmt.format(totalPayment);
      document.getElementById("totalRepayment").textContent      = fmt.format(totalRepayment);
      document.getElementById("totalEstimate").textContent       = fmt.format(totalEstimate);
    }

    // Ejecutar al cargar y asegurar primer render
    document.addEventListener("DOMContentLoaded", calculateLoan);
    // Fallback para algunos entornos de inserci√≥n
    window.addEventListener("load", calculateLoan);
  </script>
</body>
</html>
